<!-- This is the public user profile (not the private view) -->

{% extends "base.html" %}

{% block content %}

<br><br>

<h2 style="text-align: center">Public User Profile</h2>

<!-- Display publically revalent user information -->

<div>Name: {{user.firstname}} {{user.lastname}}</div>

<div>Account number: {{user.id}}</div>

<!-- if seller, also display email, address, and reviews -->

{% if user.id in sellers %}

<div>Email: {{user.email}}</div>

<div>Address: {{user.address}}</div>

<br><br>

<!-- these are reviews of this user/seller by other users -->

<!-- Import css file / star images -->
<head>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/reviews.css') }}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>


 

<!-- script in JS to display stars for each reviewer's rating -->
<!-- Return list of size 5 representing how many stars
        should be shown for review
        -1 = empty, 0 = half, 1 = full -->
<script>
  function stars(rating){
    // Star types
    let filled_star = "<span class=\"fa fa-star checked\"></span>"
    let empty_star = "<span class=\"fa fa-star-o\"></span>"
    let half_star = "<i class=\"fa fa-star-half-o\" aria-hidden=\"true\"></i>"

    let dec = rating % 1  // Number after the decimal
    let full = Math.floor(rating) // Number before decimal

    var stars = [-1, -1, -1, -1, -1]  // Initial stars all to be empty
    var half = false

    if (0.25 < dec && dec <= 0.75){
      // When decimal value in this range, we have half star
      half = true
    }

    // Update appropiate indices to be 1 for filled
    for (let i = 0; i < full; i++) {
      stars[i] = 1
    }

    if (half == true) {
      stars[full] = 0
    } else if (dec > 0.75) {
      // Round up to next star
      stars[full] = 1
    }

    // Write stars
    for (let i = 0; i < stars.length; i++) {
      let val = stars[i]
      if (val == 1) {
        document.write(filled_star)
      } else if (val == 0) {
        document.write(half_star)
      } else {
        document.write(empty_star)
      }
    }   
  }

  // Method used for selecting correct sort option after page is reloaded
  function selected(val) {
    var rec = "<option value=\"0\">Most Recent</option>"
    var desc = "<option value=\"1\">Rating (Desc)</option>"
    var asc = "<option value=\"2\">Rating (Asc) </option>"
    if (val == "0") {
      rec = "<option value=\"0\" selected>Most Recent</option>"
    } else if (val == "1") {
      desc = "<option value=\"1\" selected>Rating (Desc)</option>"
    } else {
      asc = "<option value=\"2\" selected>Rating (Asc)</option>"
    }
    document.write(rec)
    document.write(desc)
    document.write(asc)

    for (const btn of document.querySelectorAll('.vote')) {
        btn.addEventListener('click', event)
    }
  }

  // Updates upvote arrow color 
  function changeColor(val) {
    if (val == 1) {
      event.currentTarget.classList.toggle('on_up')
    } else if (val == -1) {
      event.currentTarget.classList.toggle('on_down')
    }
  }
</script> 

<h2>Seller Reviews: {{review_avg}}/5.0 ({{review_count}})</h2>
<table class='table table-hover table-bordered container'>
  <thead class="thead-dark">
    <tr>
      <th scope="col">buyer id</th>
      <th scope="col">rating</th>
      <th scope="col">comment</th>
      <th scope="col">date</th>
    </tr>
  </thead>
  <tbody>
    {% for r in reviews%}
      <tr>
        <!-- <td>{{r.buyer_id}}</td> -->
        <td><a href="{{ url_for('users.publicprofile', uid=r.buyer_id, sortoption=0) }}" type="button" class="btn btn-light">{{r.buyer_id}}</a></td>
        <td>{{r.rating}}</td>
        <td>{{r.comment}}</td>
        <td>{{r.date}}</td>
      </tr>
    {% endfor %}
  </tbody>
</table>

{% endif %}

{% endblock %}
